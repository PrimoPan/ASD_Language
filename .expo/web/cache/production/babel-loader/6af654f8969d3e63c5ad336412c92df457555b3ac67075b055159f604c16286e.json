{"ast":null,"code":"'use strict';var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.callGuardDEV=callGuardDEV;exports.initializeUIRuntime=initializeUIRuntime;exports.setupCallGuard=setupCallGuard;exports.setupConsole=setupConsole;var _slicedToArray2=_interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));var _errors=require(\"./errors.js\");var _PlatformChecker=require(\"./PlatformChecker.js\");var _threads=require(\"./threads.js\");var _mockedRequestAnimationFrame=require(\"./mockedRequestAnimationFrame.js\");var _index=require(\"./logger/index.js\");var IS_JEST=(0,_PlatformChecker.isJest)();var SHOULD_BE_USE_WEB=(0,_PlatformChecker.shouldBeUseWeb)();var IS_CHROME_DEBUGGER=(0,_PlatformChecker.isChromeDebugger)();function overrideLogFunctionImplementation(){'worklet';(0,_index.replaceLoggerImplementation)(function(data){'worklet';(0,_threads.runOnJS)(_index.logToLogBoxAndConsole)(data);});}(0,_index.registerLoggerConfig)(_index.DEFAULT_LOGGER_CONFIG);overrideLogFunctionImplementation();if(SHOULD_BE_USE_WEB){global._WORKLET=false;global._log=console.log;global._getAnimationTimestamp=function(){return performance.now();};}else{(0,_threads.executeOnUIRuntimeSync)(_errors.registerReanimatedError)();(0,_threads.executeOnUIRuntimeSync)(_index.registerLoggerConfig)(_index.DEFAULT_LOGGER_CONFIG);(0,_threads.executeOnUIRuntimeSync)(overrideLogFunctionImplementation)();}function callGuardDEV(fn){'worklet';try{for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}return fn.apply(void 0,args);}catch(e){if(global.__ErrorUtils){global.__ErrorUtils.reportFatalError(e);}else{throw e;}}}function setupCallGuard(){'worklet';global.__callGuardDEV=callGuardDEV;global.__ErrorUtils={reportFatalError:function reportFatalError(error){(0,_threads.runOnJS)(_errors.reportFatalErrorOnJS)({message:error.message,stack:error.stack});}};}function createMemorySafeCapturableConsole(){var consoleCopy=Object.fromEntries(Object.entries(console).map(function(_ref){var _ref2=(0,_slicedToArray2.default)(_ref,2),methodName=_ref2[0],method=_ref2[1];var methodWrapper=function methodWrapper(){return method.apply(void 0,arguments);};if(method.name){Object.defineProperty(methodWrapper,'name',{value:method.name,writable:false});}return[methodName,methodWrapper];}));return consoleCopy;}var capturableConsole=createMemorySafeCapturableConsole();function setupConsole(){'worklet';if(!IS_CHROME_DEBUGGER){global.console={assert:(0,_threads.runOnJS)(capturableConsole.assert),debug:(0,_threads.runOnJS)(capturableConsole.debug),log:(0,_threads.runOnJS)(capturableConsole.log),warn:(0,_threads.runOnJS)(capturableConsole.warn),error:(0,_threads.runOnJS)(capturableConsole.error),info:(0,_threads.runOnJS)(capturableConsole.info)};}}function setupRequestAnimationFrame(){'worklet';var nativeRequestAnimationFrame=global.requestAnimationFrame;var animationFrameCallbacks=[];var flushRequested=false;global.__flushAnimationFrame=function(frameTimestamp){var currentCallbacks=animationFrameCallbacks;animationFrameCallbacks=[];currentCallbacks.forEach(function(f){return f(frameTimestamp);});(0,_threads.callMicrotasks)();};global.requestAnimationFrame=function(callback){animationFrameCallbacks.push(callback);if(!flushRequested){flushRequested=true;nativeRequestAnimationFrame(function(timestamp){flushRequested=false;global.__frameTimestamp=timestamp;global.__flushAnimationFrame(timestamp);global.__frameTimestamp=undefined;});}return-1;};}function initializeUIRuntime(){if(IS_JEST){globalThis.requestAnimationFrame=_mockedRequestAnimationFrame.mockedRequestAnimationFrame;}(0,_threads.runOnUIImmediately)(function(){'worklet';setupCallGuard();setupConsole();if(!SHOULD_BE_USE_WEB){(0,_threads.setupMicrotasks)();setupRequestAnimationFrame();}})();}","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","callGuardDEV","initializeUIRuntime","setupCallGuard","setupConsole","_slicedToArray2","_errors","_PlatformChecker","_threads","_mockedRequestAnimationFrame","_index","IS_JEST","isJest","SHOULD_BE_USE_WEB","shouldBeUseWeb","IS_CHROME_DEBUGGER","isChromeDebugger","overrideLogFunctionImplementation","replaceLoggerImplementation","data","runOnJS","logToLogBoxAndConsole","registerLoggerConfig","DEFAULT_LOGGER_CONFIG","global","_WORKLET","_log","console","log","_getAnimationTimestamp","performance","now","executeOnUIRuntimeSync","registerReanimatedError","fn","_len","arguments","length","args","Array","_key","apply","e","__ErrorUtils","reportFatalError","__callGuardDEV","error","reportFatalErrorOnJS","message","stack","createMemorySafeCapturableConsole","consoleCopy","fromEntries","entries","map","_ref","_ref2","default","methodName","method","methodWrapper","name","writable","capturableConsole","assert","debug","warn","info","setupRequestAnimationFrame","nativeRequestAnimationFrame","requestAnimationFrame","animationFrameCallbacks","flushRequested","__flushAnimationFrame","frameTimestamp","currentCallbacks","forEach","f","callMicrotasks","callback","push","timestamp","__frameTimestamp","undefined","globalThis","mockedRequestAnimationFrame","runOnUIImmediately","setupMicrotasks"],"sources":["/Users/primopan/WebstormProjects/AsdLanguauge/AsdLanguage/node_modules/react-native-reanimated/src/initializers.ts"],"sourcesContent":["'use strict';\nimport { registerReanimatedError, reportFatalErrorOnJS } from './errors';\nimport { isChromeDebugger, isJest, shouldBeUseWeb } from './PlatformChecker';\nimport {\n  runOnJS,\n  setupMicrotasks,\n  callMicrotasks,\n  runOnUIImmediately,\n  executeOnUIRuntimeSync,\n} from './threads';\nimport { mockedRequestAnimationFrame } from './mockedRequestAnimationFrame';\nimport {\n  DEFAULT_LOGGER_CONFIG,\n  logToLogBoxAndConsole,\n  registerLoggerConfig,\n  replaceLoggerImplementation,\n} from './logger';\n\nconst IS_JEST = isJest();\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\nconst IS_CHROME_DEBUGGER = isChromeDebugger();\n\n// Override the logFunction implementation with the one that adds logs\n// with better stack traces to the LogBox (need to override it after `runOnJS`\n// is defined).\nfunction overrideLogFunctionImplementation() {\n  'worklet';\n  replaceLoggerImplementation((data) => {\n    'worklet';\n    runOnJS(logToLogBoxAndConsole)(data);\n  });\n}\n\n// Register logger config and replace the log function implementation in\n// the React runtime global scope\nregisterLoggerConfig(DEFAULT_LOGGER_CONFIG);\noverrideLogFunctionImplementation();\n\n// this is for web implementation\nif (SHOULD_BE_USE_WEB) {\n  global._WORKLET = false;\n  global._log = console.log;\n  global._getAnimationTimestamp = () => performance.now();\n} else {\n  // Register ReanimatedError and logger config in the UI runtime global scope.\n  // (we are using `executeOnUIRuntimeSync` here to make sure that the changes\n  // are applied before any async operations are executed on the UI runtime)\n  executeOnUIRuntimeSync(registerReanimatedError)();\n  executeOnUIRuntimeSync(registerLoggerConfig)(DEFAULT_LOGGER_CONFIG);\n  executeOnUIRuntimeSync(overrideLogFunctionImplementation)();\n}\n\n// callGuard is only used with debug builds\nexport function callGuardDEV<Args extends unknown[], ReturnValue>(\n  fn: (...args: Args) => ReturnValue,\n  ...args: Args\n): ReturnValue | void {\n  'worklet';\n  try {\n    return fn(...args);\n  } catch (e) {\n    if (global.__ErrorUtils) {\n      global.__ErrorUtils.reportFatalError(e as Error);\n    } else {\n      throw e;\n    }\n  }\n}\n\nexport function setupCallGuard() {\n  'worklet';\n  global.__callGuardDEV = callGuardDEV;\n  global.__ErrorUtils = {\n    reportFatalError: (error: Error) => {\n      runOnJS(reportFatalErrorOnJS)({\n        message: error.message,\n        stack: error.stack,\n      });\n    },\n  };\n}\n\n/**\n * Currently there seems to be a bug in the JSI layer which causes a crash when\n * we try to copy some of the console methods, i.e. `clear` or `dirxml`.\n *\n * The crash happens only in React Native 0.75. It's not reproducible in neither\n * 0.76 nor 0.74. It also happens only in the configuration of a debug app and\n * production bundle.\n *\n * I haven't yet discovered what exactly causes the crash. It's tied to the\n * console methods sometimes being `HostFunction`s. Therefore, as a workaround\n * we don't copy the methods as they are in the original console object, we copy\n * JavaScript wrappers instead.\n */\nfunction createMemorySafeCapturableConsole(): typeof console {\n  const consoleCopy = Object.fromEntries(\n    Object.entries(console).map(([methodName, method]) => {\n      const methodWrapper = function methodWrapper(...args: unknown[]) {\n        return method(...args);\n      };\n      if (method.name) {\n        /**\n         * Set the original method name as the wrapper name if available.\n         *\n         * It might be unnecessary but if we want to fully mimic the console\n         * object we should take into the account the fact some code might rely\n         * on the method name.\n         */\n        Object.defineProperty(methodWrapper, 'name', {\n          value: method.name,\n          writable: false,\n        });\n      }\n      return [methodName, methodWrapper];\n    })\n  );\n\n  return consoleCopy as unknown as typeof console;\n}\n\n// We really have to create a copy of console here. Function runOnJS we use on elements inside\n// this object makes it not configurable\nconst capturableConsole = createMemorySafeCapturableConsole();\n\nexport function setupConsole() {\n  'worklet';\n  if (!IS_CHROME_DEBUGGER) {\n    // @ts-ignore TypeScript doesn't like that there are missing methods in console object, but we don't provide all the methods for the UI runtime console version\n    global.console = {\n      /* eslint-disable @typescript-eslint/unbound-method */\n      assert: runOnJS(capturableConsole.assert),\n      debug: runOnJS(capturableConsole.debug),\n      log: runOnJS(capturableConsole.log),\n      warn: runOnJS(capturableConsole.warn),\n      error: runOnJS(capturableConsole.error),\n      info: runOnJS(capturableConsole.info),\n      /* eslint-enable @typescript-eslint/unbound-method */\n    };\n  }\n}\n\nfunction setupRequestAnimationFrame() {\n  'worklet';\n\n  // Jest mocks requestAnimationFrame API and it does not like if that mock gets overridden\n  // so we avoid doing requestAnimationFrame batching in Jest environment.\n  const nativeRequestAnimationFrame = global.requestAnimationFrame;\n\n  let animationFrameCallbacks: Array<(timestamp: number) => void> = [];\n  let flushRequested = false;\n\n  global.__flushAnimationFrame = (frameTimestamp: number) => {\n    const currentCallbacks = animationFrameCallbacks;\n    animationFrameCallbacks = [];\n    currentCallbacks.forEach((f) => f(frameTimestamp));\n    callMicrotasks();\n  };\n\n  global.requestAnimationFrame = (\n    callback: (timestamp: number) => void\n  ): number => {\n    animationFrameCallbacks.push(callback);\n    if (!flushRequested) {\n      flushRequested = true;\n      nativeRequestAnimationFrame((timestamp) => {\n        flushRequested = false;\n        global.__frameTimestamp = timestamp;\n        global.__flushAnimationFrame(timestamp);\n        global.__frameTimestamp = undefined;\n      });\n    }\n    // Reanimated currently does not support cancelling callbacks requested with\n    // requestAnimationFrame. We return -1 as identifier which isn't in line\n    // with the spec but it should give users better clue in case they actually\n    // attempt to store the value returned from rAF and use it for cancelling.\n    return -1;\n  };\n}\n\nexport function initializeUIRuntime() {\n  if (IS_JEST) {\n    // requestAnimationFrame react-native jest's setup is incorrect as it polyfills\n    // the method directly using setTimeout, therefore the callback doesn't get the\n    // expected timestamp as the only argument: https://github.com/facebook/react-native/blob/main/packages/react-native/jest/setup.js#L28\n    // We override this setup here to make sure that callbacks get the proper timestamps\n    // when executed. For non-jest environments we define requestAnimationFrame in setupRequestAnimationFrame\n    // @ts-ignore TypeScript uses Node definition for rAF, setTimeout, etc which returns a Timeout object rather than a number\n    globalThis.requestAnimationFrame = mockedRequestAnimationFrame;\n  }\n\n  runOnUIImmediately(() => {\n    'worklet';\n    setupCallGuard();\n    setupConsole();\n    if (!SHOULD_BE_USE_WEB) {\n      setupMicrotasks();\n      setupRequestAnimationFrame();\n    }\n  })();\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}