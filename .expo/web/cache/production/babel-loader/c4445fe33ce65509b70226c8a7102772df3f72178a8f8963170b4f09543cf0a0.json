{"ast":null,"code":"'use strict';var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.WorkletEventHandler=void 0;var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _classPrivateFieldLooseBase2=_interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseBase\"));var _classPrivateFieldLooseKey2=_interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseKey\"));var _core=require(\"./core.js\");var _PlatformChecker=require(\"./PlatformChecker.js\");var SHOULD_BE_USE_WEB=(0,_PlatformChecker.shouldBeUseWeb)();function jsListener(eventName,handler){return function(evt){handler(Object.assign({},evt.nativeEvent,{eventName:eventName}));};}var _viewTags=(0,_classPrivateFieldLooseKey2.default)(\"viewTags\");var _registrations=(0,_classPrivateFieldLooseKey2.default)(\"registrations\");var WorkletEventHandlerNative=function(){function WorkletEventHandlerNative(worklet,eventNames){(0,_classCallCheck2.default)(this,WorkletEventHandlerNative);Object.defineProperty(this,_viewTags,{writable:true,value:void 0});Object.defineProperty(this,_registrations,{writable:true,value:void 0});this.worklet=worklet;this.eventNames=eventNames;(0,_classPrivateFieldLooseBase2.default)(this,_viewTags)[_viewTags]=new Set();(0,_classPrivateFieldLooseBase2.default)(this,_registrations)[_registrations]=new Map();}return(0,_createClass2.default)(WorkletEventHandlerNative,[{key:\"updateEventHandler\",value:function updateEventHandler(newWorklet,newEvents){var _this=this;this.worklet=newWorklet;this.eventNames=newEvents;(0,_classPrivateFieldLooseBase2.default)(this,_registrations)[_registrations].forEach(function(registrationIDs){registrationIDs.forEach(function(id){return(0,_core.unregisterEventHandler)(id);});});Array.from((0,_classPrivateFieldLooseBase2.default)(this,_viewTags)[_viewTags]).forEach(function(tag){var newRegistrations=_this.eventNames.map(function(eventName){return(0,_core.registerEventHandler)(_this.worklet,eventName,tag);});(0,_classPrivateFieldLooseBase2.default)(_this,_registrations)[_registrations].set(tag,newRegistrations);});}},{key:\"registerForEvents\",value:function registerForEvents(viewTag,fallbackEventName){var _this2=this;(0,_classPrivateFieldLooseBase2.default)(this,_viewTags)[_viewTags].add(viewTag);var newRegistrations=this.eventNames.map(function(eventName){return(0,_core.registerEventHandler)(_this2.worklet,eventName,viewTag);});(0,_classPrivateFieldLooseBase2.default)(this,_registrations)[_registrations].set(viewTag,newRegistrations);if(this.eventNames.length===0&&fallbackEventName){var newRegistration=(0,_core.registerEventHandler)(this.worklet,fallbackEventName,viewTag);(0,_classPrivateFieldLooseBase2.default)(this,_registrations)[_registrations].set(viewTag,[newRegistration]);}}},{key:\"unregisterFromEvents\",value:function unregisterFromEvents(viewTag){var _classPrivateFieldLoo;(0,_classPrivateFieldLooseBase2.default)(this,_viewTags)[_viewTags].delete(viewTag);(_classPrivateFieldLoo=(0,_classPrivateFieldLooseBase2.default)(this,_registrations)[_registrations].get(viewTag))==null||_classPrivateFieldLoo.forEach(function(id){(0,_core.unregisterEventHandler)(id);});(0,_classPrivateFieldLooseBase2.default)(this,_registrations)[_registrations].delete(viewTag);}}]);}();var WorkletEventHandlerWeb=function(){function WorkletEventHandlerWeb(worklet){var eventNames=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];(0,_classCallCheck2.default)(this,WorkletEventHandlerWeb);this.worklet=worklet;this.eventNames=eventNames;this.listeners={};this.setupWebListeners();}return(0,_createClass2.default)(WorkletEventHandlerWeb,[{key:\"setupWebListeners\",value:function setupWebListeners(){var _this3=this;this.listeners={};this.eventNames.forEach(function(eventName){_this3.listeners[eventName]=jsListener(eventName,_this3.worklet);});}},{key:\"updateEventHandler\",value:function updateEventHandler(newWorklet,newEvents){this.worklet=newWorklet;this.eventNames=newEvents;this.setupWebListeners();}},{key:\"registerForEvents\",value:function registerForEvents(_viewTag,_fallbackEventName){}},{key:\"unregisterFromEvents\",value:function unregisterFromEvents(_viewTag){}}]);}();var WorkletEventHandler=exports.WorkletEventHandler=SHOULD_BE_USE_WEB?WorkletEventHandlerWeb:WorkletEventHandlerNative;","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","WorkletEventHandler","_classCallCheck2","_createClass2","_classPrivateFieldLooseBase2","_classPrivateFieldLooseKey2","_core","_PlatformChecker","SHOULD_BE_USE_WEB","shouldBeUseWeb","jsListener","eventName","handler","evt","assign","nativeEvent","_viewTags","default","_registrations","WorkletEventHandlerNative","worklet","eventNames","writable","Set","Map","key","updateEventHandler","newWorklet","newEvents","_this","forEach","registrationIDs","id","unregisterEventHandler","Array","from","tag","newRegistrations","map","registerEventHandler","set","registerForEvents","viewTag","fallbackEventName","_this2","add","length","newRegistration","unregisterFromEvents","_classPrivateFieldLoo","delete","get","WorkletEventHandlerWeb","arguments","undefined","listeners","setupWebListeners","_this3","_viewTag","_fallbackEventName"],"sources":["/Users/primopan/WebstormProjects/AsdLanguauge/AsdLanguage/node_modules/react-native-reanimated/src/WorkletEventHandler.ts"],"sourcesContent":["'use strict';\nimport type { NativeSyntheticEvent } from 'react-native';\nimport { registerEventHandler, unregisterEventHandler } from './core';\nimport type {\n  EventPayload,\n  ReanimatedEvent,\n  IWorkletEventHandler,\n} from './hook/commonTypes';\nimport { shouldBeUseWeb } from './PlatformChecker';\n\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\n\ntype JSEvent<Event extends object> = NativeSyntheticEvent<EventPayload<Event>>;\n\n// In JS implementation (e.g. for web) we don't use Reanimated's\n// event emitter, therefore we have to handle here\n// the event that came from React Native and convert it.\nfunction jsListener<Event extends object>(\n  eventName: string,\n  handler: (event: ReanimatedEvent<Event>) => void\n) {\n  return (evt: JSEvent<Event>) => {\n    handler({ ...evt.nativeEvent, eventName } as ReanimatedEvent<Event>);\n  };\n}\n\nclass WorkletEventHandlerNative<Event extends object>\n  implements IWorkletEventHandler<Event>\n{\n  eventNames: string[];\n  worklet: (event: ReanimatedEvent<Event>) => void;\n  #viewTags: Set<number>;\n  #registrations: Map<number, number[]>; // keys are viewTags, values are arrays of registration ID's for each viewTag\n  constructor(\n    worklet: (event: ReanimatedEvent<Event>) => void,\n    eventNames: string[]\n  ) {\n    this.worklet = worklet;\n    this.eventNames = eventNames;\n    this.#viewTags = new Set<number>();\n    this.#registrations = new Map<number, number[]>();\n  }\n\n  updateEventHandler(\n    newWorklet: (event: ReanimatedEvent<Event>) => void,\n    newEvents: string[]\n  ): void {\n    // Update worklet and event names\n    this.worklet = newWorklet;\n    this.eventNames = newEvents;\n\n    // Detach all events\n    this.#registrations.forEach((registrationIDs) => {\n      registrationIDs.forEach((id) => unregisterEventHandler(id));\n      // No need to remove registrationIDs from map, since it gets overwritten when attaching\n    });\n\n    // Attach new events with new worklet\n    Array.from(this.#viewTags).forEach((tag) => {\n      const newRegistrations = this.eventNames.map((eventName) =>\n        registerEventHandler(this.worklet, eventName, tag)\n      );\n      this.#registrations.set(tag, newRegistrations);\n    });\n  }\n\n  registerForEvents(viewTag: number, fallbackEventName?: string): void {\n    this.#viewTags.add(viewTag);\n\n    const newRegistrations = this.eventNames.map((eventName) =>\n      registerEventHandler(this.worklet, eventName, viewTag)\n    );\n    this.#registrations.set(viewTag, newRegistrations);\n\n    if (this.eventNames.length === 0 && fallbackEventName) {\n      const newRegistration = registerEventHandler(\n        this.worklet,\n        fallbackEventName,\n        viewTag\n      );\n      this.#registrations.set(viewTag, [newRegistration]);\n    }\n  }\n\n  unregisterFromEvents(viewTag: number): void {\n    this.#viewTags.delete(viewTag);\n    this.#registrations.get(viewTag)?.forEach((id) => {\n      unregisterEventHandler(id);\n    });\n    this.#registrations.delete(viewTag);\n  }\n}\n\nclass WorkletEventHandlerWeb<Event extends object>\n  implements IWorkletEventHandler<Event>\n{\n  eventNames: string[];\n  listeners:\n    | Record<string, (event: ReanimatedEvent<ReanimatedEvent<Event>>) => void>\n    | Record<string, (event: JSEvent<Event>) => void>;\n\n  worklet: (event: ReanimatedEvent<Event>) => void;\n\n  constructor(\n    worklet: (event: ReanimatedEvent<Event>) => void,\n    eventNames: string[] = []\n  ) {\n    this.worklet = worklet;\n    this.eventNames = eventNames;\n    this.listeners = {};\n    this.setupWebListeners();\n  }\n\n  setupWebListeners() {\n    this.listeners = {};\n    this.eventNames.forEach((eventName) => {\n      this.listeners[eventName] = jsListener(eventName, this.worklet);\n    });\n  }\n\n  updateEventHandler(\n    newWorklet: (event: ReanimatedEvent<Event>) => void,\n    newEvents: string[]\n  ): void {\n    // Update worklet and event names\n    this.worklet = newWorklet;\n    this.eventNames = newEvents;\n    this.setupWebListeners();\n  }\n\n  registerForEvents(_viewTag: number, _fallbackEventName?: string): void {\n    // noop\n  }\n\n  unregisterFromEvents(_viewTag: number): void {\n    // noop\n  }\n}\n\nexport const WorkletEventHandler = SHOULD_BE_USE_WEB\n  ? WorkletEventHandlerWeb\n  : WorkletEventHandlerNative;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}