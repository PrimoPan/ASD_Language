{"ast":null,"code":"'use strict';var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.NativeEventsManager=void 0;var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _classPrivateFieldLooseBase2=_interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseBase\"));var _classPrivateFieldLooseKey2=_interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseKey\"));var _utils=require(\"./utils.js\");var _WorkletEventHandler=require(\"../WorkletEventHandler.js\");var _findNodeHandle3=require(\"../platformFunctions/findNodeHandle\");var _managedComponent=(0,_classPrivateFieldLooseKey2.default)(\"managedComponent\");var _componentOptions=(0,_classPrivateFieldLooseKey2.default)(\"componentOptions\");var _eventViewTag=(0,_classPrivateFieldLooseKey2.default)(\"eventViewTag\");var NativeEventsManager=exports.NativeEventsManager=function(){function NativeEventsManager(component,options){(0,_classCallCheck2.default)(this,NativeEventsManager);Object.defineProperty(this,_managedComponent,{writable:true,value:void 0});Object.defineProperty(this,_componentOptions,{writable:true,value:void 0});Object.defineProperty(this,_eventViewTag,{writable:true,value:-1});(0,_classPrivateFieldLooseBase2.default)(this,_managedComponent)[_managedComponent]=component;(0,_classPrivateFieldLooseBase2.default)(this,_componentOptions)[_componentOptions]=options;(0,_classPrivateFieldLooseBase2.default)(this,_eventViewTag)[_eventViewTag]=this.getEventViewTag();}return(0,_createClass2.default)(NativeEventsManager,[{key:\"attachEvents\",value:function attachEvents(){var _this=this;executeForEachEventHandler((0,_classPrivateFieldLooseBase2.default)(this,_managedComponent)[_managedComponent].props,function(key,handler){handler.registerForEvents((0,_classPrivateFieldLooseBase2.default)(_this,_eventViewTag)[_eventViewTag],key);});}},{key:\"detachEvents\",value:function detachEvents(){var _this2=this;executeForEachEventHandler((0,_classPrivateFieldLooseBase2.default)(this,_managedComponent)[_managedComponent].props,function(_key,handler){handler.unregisterFromEvents((0,_classPrivateFieldLooseBase2.default)(_this2,_eventViewTag)[_eventViewTag]);});}},{key:\"updateEvents\",value:function updateEvents(prevProps){var _this3=this;var computedEventTag=this.getEventViewTag();if((0,_classPrivateFieldLooseBase2.default)(this,_eventViewTag)[_eventViewTag]!==computedEventTag){executeForEachEventHandler(prevProps,function(_key,handler){handler.unregisterFromEvents((0,_classPrivateFieldLooseBase2.default)(_this3,_eventViewTag)[_eventViewTag]);});(0,_classPrivateFieldLooseBase2.default)(this,_eventViewTag)[_eventViewTag]=computedEventTag;this.attachEvents();return;}executeForEachEventHandler(prevProps,function(key,prevHandler){var newProp=(0,_classPrivateFieldLooseBase2.default)(_this3,_managedComponent)[_managedComponent].props[key];if(!newProp){prevHandler.unregisterFromEvents((0,_classPrivateFieldLooseBase2.default)(_this3,_eventViewTag)[_eventViewTag]);}else if(isWorkletEventHandler(newProp)&&newProp.workletEventHandler!==prevHandler){prevHandler.unregisterFromEvents((0,_classPrivateFieldLooseBase2.default)(_this3,_eventViewTag)[_eventViewTag]);newProp.workletEventHandler.registerForEvents((0,_classPrivateFieldLooseBase2.default)(_this3,_eventViewTag)[_eventViewTag]);}});executeForEachEventHandler((0,_classPrivateFieldLooseBase2.default)(this,_managedComponent)[_managedComponent].props,function(key,handler){if(!prevProps[key]){handler.registerForEvents((0,_classPrivateFieldLooseBase2.default)(_this3,_eventViewTag)[_eventViewTag]);}});}},{key:\"getEventViewTag\",value:function getEventViewTag(){var componentAnimatedRef=(0,_classPrivateFieldLooseBase2.default)(this,_managedComponent)[_managedComponent]._component;var newTag;if(componentAnimatedRef.getScrollableNode){var _findNodeHandle;var scrollableNode=componentAnimatedRef.getScrollableNode();newTag=(_findNodeHandle=(0,_findNodeHandle3.findNodeHandle)(scrollableNode))!=null?_findNodeHandle:-1;}else{var _findNodeHandle2,_classPrivateFieldLoo;newTag=(_findNodeHandle2=(0,_findNodeHandle3.findNodeHandle)((_classPrivateFieldLoo=(0,_classPrivateFieldLooseBase2.default)(this,_componentOptions)[_componentOptions])!=null&&_classPrivateFieldLoo.setNativeProps?(0,_classPrivateFieldLooseBase2.default)(this,_managedComponent)[_managedComponent]:componentAnimatedRef))!=null?_findNodeHandle2:-1;}return newTag;}}]);}();function isWorkletEventHandler(prop){return(0,_utils.has)('workletEventHandler',prop)&&prop.workletEventHandler instanceof _WorkletEventHandler.WorkletEventHandler;}function executeForEachEventHandler(props,callback){for(var key in props){var prop=props[key];if(isWorkletEventHandler(prop)){callback(key,prop.workletEventHandler);}}}","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","NativeEventsManager","_classCallCheck2","_createClass2","_classPrivateFieldLooseBase2","_classPrivateFieldLooseKey2","_utils","_WorkletEventHandler","_findNodeHandle3","_managedComponent","default","_componentOptions","_eventViewTag","component","options","writable","getEventViewTag","key","attachEvents","_this","executeForEachEventHandler","props","handler","registerForEvents","detachEvents","_this2","_key","unregisterFromEvents","updateEvents","prevProps","_this3","computedEventTag","prevHandler","newProp","isWorkletEventHandler","workletEventHandler","componentAnimatedRef","_component","newTag","getScrollableNode","_findNodeHandle","scrollableNode","findNodeHandle","_findNodeHandle2","_classPrivateFieldLoo","setNativeProps","prop","has","WorkletEventHandler","callback"],"sources":["/Users/primopan/WebstormProjects/AsdLanguauge/AsdLanguage/node_modules/react-native-reanimated/src/createAnimatedComponent/NativeEventsManager.ts"],"sourcesContent":["'use strict';\nimport type {\n  INativeEventsManager,\n  IAnimatedComponentInternal,\n  AnimatedComponentProps,\n  InitialComponentProps,\n  AnimatedComponentRef,\n} from './commonTypes';\nimport { has } from './utils';\nimport { WorkletEventHandler } from '../WorkletEventHandler';\nimport { findNodeHandle } from '../platformFunctions/findNodeHandle';\n\nexport class NativeEventsManager implements INativeEventsManager {\n  readonly #managedComponent: ManagedAnimatedComponent;\n  readonly #componentOptions?: ComponentOptions;\n  #eventViewTag = -1;\n\n  constructor(component: ManagedAnimatedComponent, options?: ComponentOptions) {\n    this.#managedComponent = component;\n    this.#componentOptions = options;\n    this.#eventViewTag = this.getEventViewTag();\n  }\n\n  public attachEvents() {\n    executeForEachEventHandler(this.#managedComponent.props, (key, handler) => {\n      handler.registerForEvents(this.#eventViewTag, key);\n    });\n  }\n\n  public detachEvents() {\n    executeForEachEventHandler(\n      this.#managedComponent.props,\n      (_key, handler) => {\n        handler.unregisterFromEvents(this.#eventViewTag);\n      }\n    );\n  }\n\n  public updateEvents(\n    prevProps: AnimatedComponentProps<InitialComponentProps>\n  ) {\n    const computedEventTag = this.getEventViewTag();\n    // If the event view tag changes, we need to completely re-mount all events\n    if (this.#eventViewTag !== computedEventTag) {\n      // Remove all bindings from previous props that ran on the old viewTag\n      executeForEachEventHandler(prevProps, (_key, handler) => {\n        handler.unregisterFromEvents(this.#eventViewTag);\n      });\n      // We don't need to unregister from current (new) props, because their events weren't registered yet\n      // Replace the view tag\n      this.#eventViewTag = computedEventTag;\n      // Attach the events with a new viewTag\n      this.attachEvents();\n      return;\n    }\n\n    executeForEachEventHandler(prevProps, (key, prevHandler) => {\n      const newProp = this.#managedComponent.props[key];\n      if (!newProp) {\n        // Prop got deleted\n        prevHandler.unregisterFromEvents(this.#eventViewTag);\n      } else if (\n        isWorkletEventHandler(newProp) &&\n        newProp.workletEventHandler !== prevHandler\n      ) {\n        // Prop got changed\n        prevHandler.unregisterFromEvents(this.#eventViewTag);\n        newProp.workletEventHandler.registerForEvents(this.#eventViewTag);\n      }\n    });\n\n    executeForEachEventHandler(this.#managedComponent.props, (key, handler) => {\n      if (!prevProps[key]) {\n        // Prop got added\n        handler.registerForEvents(this.#eventViewTag);\n      }\n    });\n  }\n\n  private getEventViewTag() {\n    // Get the tag for registering events - since the event emitting view can be nested inside the main component\n    const componentAnimatedRef = this.#managedComponent\n      ._component as AnimatedComponentRef;\n    let newTag: number;\n    if (componentAnimatedRef.getScrollableNode) {\n      const scrollableNode = componentAnimatedRef.getScrollableNode();\n      newTag = findNodeHandle(scrollableNode) ?? -1;\n    } else {\n      newTag =\n        findNodeHandle(\n          this.#componentOptions?.setNativeProps\n            ? this.#managedComponent\n            : componentAnimatedRef\n        ) ?? -1;\n    }\n    return newTag;\n  }\n}\n\nfunction isWorkletEventHandler(\n  prop: unknown\n): prop is WorkletEventHandlerHolder {\n  return (\n    has('workletEventHandler', prop) &&\n    prop.workletEventHandler instanceof WorkletEventHandler\n  );\n}\n\nfunction executeForEachEventHandler(\n  props: AnimatedComponentProps<InitialComponentProps>,\n  callback: (\n    key: string,\n    handler: InstanceType<typeof WorkletEventHandler>\n  ) => void\n) {\n  for (const key in props) {\n    const prop = props[key];\n    if (isWorkletEventHandler(prop)) {\n      callback(key, prop.workletEventHandler);\n    }\n  }\n}\n\ntype ManagedAnimatedComponent = React.Component<\n  AnimatedComponentProps<InitialComponentProps>\n> &\n  IAnimatedComponentInternal;\n\ntype ComponentOptions = {\n  setNativeProps: (\n    ref: AnimatedComponentRef,\n    props: InitialComponentProps\n  ) => void;\n};\n\ntype WorkletEventHandlerHolder = {\n  workletEventHandler: InstanceType<typeof WorkletEventHandler>;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}