{"ast":null,"code":"'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.callGuardDEV = callGuardDEV;\nexports.initializeUIRuntime = initializeUIRuntime;\nexports.setupCallGuard = setupCallGuard;\nexports.setupConsole = setupConsole;\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\nvar _errors = require(\"./errors.js\");\nvar _PlatformChecker = require(\"./PlatformChecker.js\");\nvar _threads = require(\"./threads.js\");\nvar _mockedRequestAnimationFrame = require(\"./mockedRequestAnimationFrame.js\");\nvar _index = require(\"./logger/index.js\");\nvar IS_JEST = (0, _PlatformChecker.isJest)();\nvar SHOULD_BE_USE_WEB = (0, _PlatformChecker.shouldBeUseWeb)();\nvar IS_CHROME_DEBUGGER = (0, _PlatformChecker.isChromeDebugger)();\nfunction overrideLogFunctionImplementation() {\n  'worklet';\n\n  (0, _index.replaceLoggerImplementation)(function (data) {\n    'worklet';\n\n    (0, _threads.runOnJS)(_index.logToLogBoxAndConsole)(data);\n  });\n}\n(0, _index.registerLoggerConfig)(_index.DEFAULT_LOGGER_CONFIG);\noverrideLogFunctionImplementation();\nif (SHOULD_BE_USE_WEB) {\n  global._WORKLET = false;\n  global._log = console.log;\n  global._getAnimationTimestamp = function () {\n    return performance.now();\n  };\n} else {\n  (0, _threads.executeOnUIRuntimeSync)(_errors.registerReanimatedError)();\n  (0, _threads.executeOnUIRuntimeSync)(_index.registerLoggerConfig)(_index.DEFAULT_LOGGER_CONFIG);\n  (0, _threads.executeOnUIRuntimeSync)(overrideLogFunctionImplementation)();\n}\nfunction callGuardDEV(fn) {\n  'worklet';\n\n  try {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    return fn.apply(void 0, args);\n  } catch (e) {\n    if (global.__ErrorUtils) {\n      global.__ErrorUtils.reportFatalError(e);\n    } else {\n      throw e;\n    }\n  }\n}\nfunction setupCallGuard() {\n  'worklet';\n\n  global.__callGuardDEV = callGuardDEV;\n  global.__ErrorUtils = {\n    reportFatalError: function reportFatalError(error) {\n      (0, _threads.runOnJS)(_errors.reportFatalErrorOnJS)({\n        message: error.message,\n        stack: error.stack\n      });\n    }\n  };\n}\nfunction createMemorySafeCapturableConsole() {\n  var consoleCopy = Object.fromEntries(Object.entries(console).map(function (_ref) {\n    var _ref2 = (0, _slicedToArray2.default)(_ref, 2),\n      methodName = _ref2[0],\n      method = _ref2[1];\n    var methodWrapper = function methodWrapper() {\n      return method.apply(void 0, arguments);\n    };\n    if (method.name) {\n      Object.defineProperty(methodWrapper, 'name', {\n        value: method.name,\n        writable: false\n      });\n    }\n    return [methodName, methodWrapper];\n  }));\n  return consoleCopy;\n}\nvar capturableConsole = createMemorySafeCapturableConsole();\nfunction setupConsole() {\n  'worklet';\n\n  if (!IS_CHROME_DEBUGGER) {\n    global.console = {\n      assert: (0, _threads.runOnJS)(capturableConsole.assert),\n      debug: (0, _threads.runOnJS)(capturableConsole.debug),\n      log: (0, _threads.runOnJS)(capturableConsole.log),\n      warn: (0, _threads.runOnJS)(capturableConsole.warn),\n      error: (0, _threads.runOnJS)(capturableConsole.error),\n      info: (0, _threads.runOnJS)(capturableConsole.info)\n    };\n  }\n}\nfunction setupRequestAnimationFrame() {\n  'worklet';\n  var nativeRequestAnimationFrame = global.requestAnimationFrame;\n  var animationFrameCallbacks = [];\n  var flushRequested = false;\n  global.__flushAnimationFrame = function (frameTimestamp) {\n    var currentCallbacks = animationFrameCallbacks;\n    animationFrameCallbacks = [];\n    currentCallbacks.forEach(function (f) {\n      return f(frameTimestamp);\n    });\n    (0, _threads.callMicrotasks)();\n  };\n  global.requestAnimationFrame = function (callback) {\n    animationFrameCallbacks.push(callback);\n    if (!flushRequested) {\n      flushRequested = true;\n      nativeRequestAnimationFrame(function (timestamp) {\n        flushRequested = false;\n        global.__frameTimestamp = timestamp;\n        global.__flushAnimationFrame(timestamp);\n        global.__frameTimestamp = undefined;\n      });\n    }\n    return -1;\n  };\n}\nfunction initializeUIRuntime() {\n  if (IS_JEST) {\n    globalThis.requestAnimationFrame = _mockedRequestAnimationFrame.mockedRequestAnimationFrame;\n  }\n  (0, _threads.runOnUIImmediately)(function () {\n    'worklet';\n\n    setupCallGuard();\n    setupConsole();\n    if (!SHOULD_BE_USE_WEB) {\n      (0, _threads.setupMicrotasks)();\n      setupRequestAnimationFrame();\n    }\n  })();\n}","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","callGuardDEV","initializeUIRuntime","setupCallGuard","setupConsole","_slicedToArray2","_errors","_PlatformChecker","_threads","_mockedRequestAnimationFrame","_index","IS_JEST","isJest","SHOULD_BE_USE_WEB","shouldBeUseWeb","IS_CHROME_DEBUGGER","isChromeDebugger","overrideLogFunctionImplementation","replaceLoggerImplementation","data","runOnJS","logToLogBoxAndConsole","registerLoggerConfig","DEFAULT_LOGGER_CONFIG","global","_WORKLET","_log","console","log","_getAnimationTimestamp","performance","now","executeOnUIRuntimeSync","registerReanimatedError","fn","_len","arguments","length","args","Array","_key","apply","e","__ErrorUtils","reportFatalError","__callGuardDEV","error","reportFatalErrorOnJS","message","stack","createMemorySafeCapturableConsole","consoleCopy","fromEntries","entries","map","_ref","_ref2","default","methodName","method","methodWrapper","name","writable","capturableConsole","assert","debug","warn","info","setupRequestAnimationFrame","nativeRequestAnimationFrame","requestAnimationFrame","animationFrameCallbacks","flushRequested","__flushAnimationFrame","frameTimestamp","currentCallbacks","forEach","f","callMicrotasks","callback","push","timestamp","__frameTimestamp","undefined","globalThis","mockedRequestAnimationFrame","runOnUIImmediately","setupMicrotasks"],"sources":["/Users/primopan/WebstormProjects/AsdLanguauge/AsdLanguage/node_modules/react-native-reanimated/src/initializers.ts"],"sourcesContent":["'use strict';\nimport { registerReanimatedError, reportFatalErrorOnJS } from './errors';\nimport { isChromeDebugger, isJest, shouldBeUseWeb } from './PlatformChecker';\nimport {\n  runOnJS,\n  setupMicrotasks,\n  callMicrotasks,\n  runOnUIImmediately,\n  executeOnUIRuntimeSync,\n} from './threads';\nimport { mockedRequestAnimationFrame } from './mockedRequestAnimationFrame';\nimport {\n  DEFAULT_LOGGER_CONFIG,\n  logToLogBoxAndConsole,\n  registerLoggerConfig,\n  replaceLoggerImplementation,\n} from './logger';\n\nconst IS_JEST = isJest();\nconst SHOULD_BE_USE_WEB = shouldBeUseWeb();\nconst IS_CHROME_DEBUGGER = isChromeDebugger();\n\n// Override the logFunction implementation with the one that adds logs\n// with better stack traces to the LogBox (need to override it after `runOnJS`\n// is defined).\nfunction overrideLogFunctionImplementation() {\n  'worklet';\n  replaceLoggerImplementation((data) => {\n    'worklet';\n    runOnJS(logToLogBoxAndConsole)(data);\n  });\n}\n\n// Register logger config and replace the log function implementation in\n// the React runtime global scope\nregisterLoggerConfig(DEFAULT_LOGGER_CONFIG);\noverrideLogFunctionImplementation();\n\n// this is for web implementation\nif (SHOULD_BE_USE_WEB) {\n  global._WORKLET = false;\n  global._log = console.log;\n  global._getAnimationTimestamp = () => performance.now();\n} else {\n  // Register ReanimatedError and logger config in the UI runtime global scope.\n  // (we are using `executeOnUIRuntimeSync` here to make sure that the changes\n  // are applied before any async operations are executed on the UI runtime)\n  executeOnUIRuntimeSync(registerReanimatedError)();\n  executeOnUIRuntimeSync(registerLoggerConfig)(DEFAULT_LOGGER_CONFIG);\n  executeOnUIRuntimeSync(overrideLogFunctionImplementation)();\n}\n\n// callGuard is only used with debug builds\nexport function callGuardDEV<Args extends unknown[], ReturnValue>(\n  fn: (...args: Args) => ReturnValue,\n  ...args: Args\n): ReturnValue | void {\n  'worklet';\n  try {\n    return fn(...args);\n  } catch (e) {\n    if (global.__ErrorUtils) {\n      global.__ErrorUtils.reportFatalError(e as Error);\n    } else {\n      throw e;\n    }\n  }\n}\n\nexport function setupCallGuard() {\n  'worklet';\n  global.__callGuardDEV = callGuardDEV;\n  global.__ErrorUtils = {\n    reportFatalError: (error: Error) => {\n      runOnJS(reportFatalErrorOnJS)({\n        message: error.message,\n        stack: error.stack,\n      });\n    },\n  };\n}\n\n/**\n * Currently there seems to be a bug in the JSI layer which causes a crash when\n * we try to copy some of the console methods, i.e. `clear` or `dirxml`.\n *\n * The crash happens only in React Native 0.75. It's not reproducible in neither\n * 0.76 nor 0.74. It also happens only in the configuration of a debug app and\n * production bundle.\n *\n * I haven't yet discovered what exactly causes the crash. It's tied to the\n * console methods sometimes being `HostFunction`s. Therefore, as a workaround\n * we don't copy the methods as they are in the original console object, we copy\n * JavaScript wrappers instead.\n */\nfunction createMemorySafeCapturableConsole(): typeof console {\n  const consoleCopy = Object.fromEntries(\n    Object.entries(console).map(([methodName, method]) => {\n      const methodWrapper = function methodWrapper(...args: unknown[]) {\n        return method(...args);\n      };\n      if (method.name) {\n        /**\n         * Set the original method name as the wrapper name if available.\n         *\n         * It might be unnecessary but if we want to fully mimic the console\n         * object we should take into the account the fact some code might rely\n         * on the method name.\n         */\n        Object.defineProperty(methodWrapper, 'name', {\n          value: method.name,\n          writable: false,\n        });\n      }\n      return [methodName, methodWrapper];\n    })\n  );\n\n  return consoleCopy as unknown as typeof console;\n}\n\n// We really have to create a copy of console here. Function runOnJS we use on elements inside\n// this object makes it not configurable\nconst capturableConsole = createMemorySafeCapturableConsole();\n\nexport function setupConsole() {\n  'worklet';\n  if (!IS_CHROME_DEBUGGER) {\n    // @ts-ignore TypeScript doesn't like that there are missing methods in console object, but we don't provide all the methods for the UI runtime console version\n    global.console = {\n      /* eslint-disable @typescript-eslint/unbound-method */\n      assert: runOnJS(capturableConsole.assert),\n      debug: runOnJS(capturableConsole.debug),\n      log: runOnJS(capturableConsole.log),\n      warn: runOnJS(capturableConsole.warn),\n      error: runOnJS(capturableConsole.error),\n      info: runOnJS(capturableConsole.info),\n      /* eslint-enable @typescript-eslint/unbound-method */\n    };\n  }\n}\n\nfunction setupRequestAnimationFrame() {\n  'worklet';\n\n  // Jest mocks requestAnimationFrame API and it does not like if that mock gets overridden\n  // so we avoid doing requestAnimationFrame batching in Jest environment.\n  const nativeRequestAnimationFrame = global.requestAnimationFrame;\n\n  let animationFrameCallbacks: Array<(timestamp: number) => void> = [];\n  let flushRequested = false;\n\n  global.__flushAnimationFrame = (frameTimestamp: number) => {\n    const currentCallbacks = animationFrameCallbacks;\n    animationFrameCallbacks = [];\n    currentCallbacks.forEach((f) => f(frameTimestamp));\n    callMicrotasks();\n  };\n\n  global.requestAnimationFrame = (\n    callback: (timestamp: number) => void\n  ): number => {\n    animationFrameCallbacks.push(callback);\n    if (!flushRequested) {\n      flushRequested = true;\n      nativeRequestAnimationFrame((timestamp) => {\n        flushRequested = false;\n        global.__frameTimestamp = timestamp;\n        global.__flushAnimationFrame(timestamp);\n        global.__frameTimestamp = undefined;\n      });\n    }\n    // Reanimated currently does not support cancelling callbacks requested with\n    // requestAnimationFrame. We return -1 as identifier which isn't in line\n    // with the spec but it should give users better clue in case they actually\n    // attempt to store the value returned from rAF and use it for cancelling.\n    return -1;\n  };\n}\n\nexport function initializeUIRuntime() {\n  if (IS_JEST) {\n    // requestAnimationFrame react-native jest's setup is incorrect as it polyfills\n    // the method directly using setTimeout, therefore the callback doesn't get the\n    // expected timestamp as the only argument: https://github.com/facebook/react-native/blob/main/packages/react-native/jest/setup.js#L28\n    // We override this setup here to make sure that callbacks get the proper timestamps\n    // when executed. For non-jest environments we define requestAnimationFrame in setupRequestAnimationFrame\n    // @ts-ignore TypeScript uses Node definition for rAF, setTimeout, etc which returns a Timeout object rather than a number\n    globalThis.requestAnimationFrame = mockedRequestAnimationFrame;\n  }\n\n  runOnUIImmediately(() => {\n    'worklet';\n    setupCallGuard();\n    setupConsole();\n    if (!SHOULD_BE_USE_WEB) {\n      setupMicrotasks();\n      setupRequestAnimationFrame();\n    }\n  })();\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}